<mat-card>
  <mat-card-header class="center-content">
    <app-titulo-linea title="Consulta de Contratos Calificados"></app-titulo-linea>
    <!-- Otros elementos dentro de mat-card-header -->
  </mat-card-header>

  <div class="filter-bar">

    <!-- Campo de Búsqueda (Siempre Visible) -->
    <mat-form-field appearance="fill">
      <mat-label>Buscar</mat-label>
      <mat-icon matPrefix>search</mat-icon>
      <input matInput (keyup)="applyFilter($event)" placeholder="Escribe para buscar...">
    </mat-form-field>

    <!-- Selector de Tipo de Filtro -->
    <mat-form-field appearance="fill">
      <mat-label>Tipo de Filtro</mat-label>
      <mat-icon matPrefix>filter_list</mat-icon>
      <mat-select [(value)]="selectedFilter">
        <mat-option value="calificacion">Calificación</mat-option>
        <mat-option value="fechaInicio">Fecha de Inicio</mat-option>
        <mat-option value="fechaFin">Fecha de Finalización</mat-option>
      </mat-select>
    </mat-form-field>
    

    <!-- Filtros Condicionales -->
    <!-- Filtro por Calificación -->
    <mat-form-field *ngIf="selectedFilter === 'calificacion'" appearance="fill">
      <mat-label>Calificación</mat-label>
      <input type="number" matInput (keyup)="applyScoreTotalFilter($event)" placeholder="Calificación (0 a 5)" min="0"
        max="5" step="0.1">
    </mat-form-field>

    <!-- Filtro por Fecha de Inicio -->
    <mat-form-field *ngIf="selectedFilter === 'fechaInicio'" appearance="fill">
      <mat-label>Fecha de Inicio</mat-label>
      <input matInput [matDatepicker]="picker" (dateChange)="applyDateFilter($event)">
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>

    <!-- Filtro por Fecha de Finalización -->
    <mat-form-field *ngIf="selectedFilter === 'fechaFin'" appearance="fill">
      <mat-label>Fecha de Finalización</mat-label>
      <input matInput [matDatepicker]="finalDatePicker" (dateChange)="applyFinalDateFilter($event)">
      <mat-datepicker-toggle matSuffix [for]="finalDatePicker"></mat-datepicker-toggle>
      <mat-datepicker #finalDatePicker></mat-datepicker>
    </mat-form-field>

    <!-- Botón para Borrar Filtros -->
    <div class="clear-filters-btn">
      <button mat-button (click)="clearFilters()">
        <mat-icon>delete</mat-icon> Borrar Filtros
      </button>
    </div>

  </div>



  <mat-card-content>
    <div class="mat-elevation-z3 responsive-table-container">
      <mat-table [dataSource]="dataSource">
        <ng-container matColumnDef="referencia">
          <th mat-header-cell *matHeaderCellDef> Referencia </th>
          <td mat-cell *matCellDef="let row"> {{row.reference}} </td>
        </ng-container>

        <ng-container matColumnDef="contractType">
          <th mat-header-cell *matHeaderCellDef>Tipo de Contrato</th>
          <td mat-cell *matCellDef="let row"> {{row.contractType}} </td>
        </ng-container>

        <ng-container matColumnDef="modality">
          <th mat-header-cell *matHeaderCellDef>Modalidad</th>
          <td mat-cell *matCellDef="let row"> {{row.modality}} </td>
        </ng-container>

        <ng-container matColumnDef="initialDate">
          <th mat-header-cell *matHeaderCellDef>Fecha Inicio</th>
          <td mat-cell *matCellDef="let row"> {{row.initialDate |date:'yyyy-MM-dd' }} </td>
        </ng-container>

        <ng-container matColumnDef="finalDate">
          <th mat-header-cell *matHeaderCellDef>Fecha Fin</th>
          <td mat-cell *matCellDef="let row"> {{row.finalDate | date:'yyyy-MM-dd'}} </td>
        </ng-container>

        <ng-container matColumnDef="scoreTotal">
          <th mat-header-cell *matHeaderCellDef>Calificación</th>
          <td mat-cell *matCellDef="let row"> {{row.scoreTotal}} </td>
        </ng-container>

        <ng-container matColumnDef="descarga">
          <th mat-header-cell *matHeaderCellDef>Descarga</th>
          <td mat-cell *matCellDef="let row">
            <a (click)="setIdContract(row.reference, row.initialDate)">
              <div class="circle flex items-center justify-center"><i-lucide name="FolderDown"></i-lucide></div>
            </a>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns" class></tr>
        <tr mat-row *matRowDef="let row; let i = index; columns: displayedColumns;"
          [ngClass]="{'selected-row': i === selectedRowIndex}" (click)="selectRow(i)">
        </tr>
      </mat-table>
    </div>
    <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
  </mat-card-content>
</mat-card>